<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Inköpslista</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    h1 { color: #2c3e50; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    input[type="checkbox"] { margin-right: 8px; }
  </style>
</head>
<body>
  <h1>🛒 Inköpslista</h1>
  <input id="itemInput" placeholder="Lägg till vara..." />
  <button onclick="addItem()">➕ Lägg till</button>
  <ul id="itemList"></ul>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";

    // 🔑 Byt ut mot ditt Supabase-projekts värden
    const SUPABASE_URL = "https://wkdognpbmqrtuxbpsiie.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrZG9nbnBibXFydHV4YnBzaWllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NTE2NDQsImV4cCI6MjA3NDEyNzY0NH0.l6F-mhXSkJxiQuQU8aAA3Iu0FXdaG5HgWxJQ3it7HUE";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const itemList = document.getElementById("itemList");
    const itemInput = document.getElementById("itemInput");

    // Hämta lista
    async function loadItems() {
      const { data } = await supabase.from("items").select("*").order("id");
      renderItems(data);
    }

    // Rendera lista i DOM
    function renderItems(items) {
      itemList.innerHTML = "";
      items.forEach(item => {
        const li = document.createElement("li");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.onchange = () => toggleItem(item.id, !item.checked);

        li.appendChild(checkbox);
        li.appendChild(document.createTextNode(item.name));
        itemList.appendChild(li);
      });
    }

    // Lägg till vara
    async function addItem() {
      const name = itemInput.value.trim();
      if (!name) return;
      await supabase.from("items").insert([{ name }]);
      itemInput.value = "";
    }

    // Uppdatera avbockning
    async function toggleItem(id, checked) {
      await supabase.from("items").update({ checked }).eq("id", id);
    }

    // Realtidsuppdatering
    supabase.channel("room1")
      .on("postgres_changes", { event: "*", schema: "public", table: "items" }, payload => {
        loadItems(); // laddar om listan när något ändras
      })
      .subscribe();

    loadItems();
  </script>
</body>
</html>
