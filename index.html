<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Ink√∂pslista</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    h1 { color: #2c3e50; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    input[type="checkbox"] { margin-right: 8px; }
    #messageBox { margin: 10px 0; font-weight: bold; }
    .error { color: red; }
    .success { color: green; }
    #loading { color: #555; margin: 10px 0; font-style: italic; }
  </style>
</head>
<body>
  <h1>üõí Ink√∂pslista v1</h1>
  <div id="messageBox"></div>
  <div id="loading" style="display:none;">Laddar lista...</div>

  <input id="itemInput" placeholder="L√§gg till vara..." />
  <button onclick="addItem()">‚ûï L√§gg till</button>
  <ul id="itemList"></ul>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";

    // üîë Byt ut mot ditt Supabase-projekts v√§rden
    const SUPABASE_URL = "https://DIN-PROJEKT-URL.supabase.co";
    const SUPABASE_KEY = "DIN-ANON-KEY";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const itemList = document.getElementById("itemList");
    const itemInput = document.getElementById("itemInput");
    const messageBox = document.getElementById("messageBox");
    const loading = document.getElementById("loading");

    function showMessage(msg, type = "success") {
      messageBox.textContent = msg;
      messageBox.className = type; // "success" eller "error"
      setTimeout(() => { messageBox.textContent = ""; }, 4000);
    }

    function showLoading(show) {
      loading.style.display = show ? "block" : "none";
    }

    // H√§mta lista
    async function loadItems() {
      try {
        showLoading(true);
        const { data, error } = await supabase.from("items").select("*").order("id");
        if (error) throw error;
        renderItems(data);
      } catch (err) {
        console.error("Fel vid fetch:", err);
        showMessage("‚ùå Kunde inte ladda listan.", "error");
      } finally {
        showLoading(false);
      }
    }

    // Rendera lista i DOM
    function renderItems(items) {
      itemList.innerHTML = "";
      items.forEach(item => {
        const li = document.createElement("li");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.onchange = () => toggleItem(item.id, !item.checked);

        li.appendChild(checkbox);
        li.appendChild(document.createTextNode(item.name));
        itemList.appendChild(li);
      });
    }

    // L√§gg till vara
    async function addItem() {
      const name = itemInput.value.trim();
      if (!name) return;

      try {
        const { error } = await supabase.from("items").insert([{ name }]);
        if (error) throw error;
        itemInput.value = "";
        showMessage("‚úÖ Varor tillagd!", "success");
      } catch (err) {
        console.error("Fel vid insert:", err);
        showMessage("‚ùå Kunde inte l√§gga till vara. Kontrollera anslutningen.", "error");
      }
    }

    // Uppdatera avbockning
    async function toggleItem(id, checked) {
      try {
        const { error } = await supabase.from("items").update({ checked }).eq("id", id);
        if (error) throw error;
        showMessage("‚úÖ Uppdatering sparad!", "success");
      } catch (err) {
        console.error("Fel vid update:", err);
        showMessage("‚ùå Kunde inte uppdatera vara.", "error");
      }
    }

    // Realtidsuppdatering
    supabase.channel("room1")
      .on("postgres_changes", { event_
