<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Inköpslista</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>
  <h1>🛒 Inköpslista</h1>
  
  <input id="itemInput" type="text" placeholder="Lägg till vara..." />
  <button onclick="addItem()">Lägg till</button>
  
  <p id="message"></p>
  <ul id="list"></ul>

  <script>
    const SUPABASE_URL = "https://wkdognpbmqrtuxbpsiie.supabase.co"; 
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrZG9nbnBibXFydHV4YnBzaWllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NTE2NDQsImV4cCI6MjA3NDEyNzY0NH0.l6F-mhXSkJxiQuQU8aAA3Iu0FXdaG5HgWxJQ3it7HUE"; 
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const list = document.getElementById("list");
    const message = document.getElementById("message");

    async function addItem() {
      const input = document.getElementById("itemInput");
      const name = input.value.trim();

      if (!name) {
        message.textContent = "⚠️ Du måste skriva något!";
        return;
      }

      message.textContent = "⏳ Lägger till...";
      console.log("Försöker lägga till:", name);

      try {
        const { data, error } = await supabase
          .from("items")
          .insert([{ name, checked: false }]);

        if (error) {
          console.error("Supabase-fel:", error);
          message.textContent = "❌ Kunde inte lägga till (" + error.message + ")";
        } else {
          console.log("Inlagt:", data);
          message.textContent = "✅ Tillagd!";
          input.value = "";
          loadItems();
        }
      } catch (err) {
        console.error("Kodfel:", err);
        message.textContent = "💥 Tekniskt fel: " + err.message;
      }
    }

    async function loadItems() {
      list.innerHTML = "";
      const { data, error } = await supabase.from("items").select("*");

      if (error) {
        console.error("Fel vid hämtning:", error);
        message.textContent = "⚠️ Kunde inte hämta listan.";
        return;
      }

      data.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item.name + (item.checked ? " ✅" : "");
        list.appendChild(li);
      });
    }

    // Ladda listan direkt
    loadItems();
  </script>
</body>
</html>
