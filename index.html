<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>InkÃ¶pslista</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    h1 { color: #2c3e50; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    input[type="checkbox"] { margin-right: 8px; }
    #errorBox { color: red; margin: 10px 0; }
    #loading { color: #555; margin: 10px 0; font-style: italic; }
  </style>
</head>
<body>
  <h1>ðŸ›’ InkÃ¶pslista</h1>
  <div id="errorBox"></div>
  <div id="loading" style="display:none;">Laddar lista...</div>

  <input id="itemInput" placeholder="LÃ¤gg till vara..." />
  <button onclick="addItem()">âž• LÃ¤gg till</button>
  <ul id="itemList"></ul>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";

    // ðŸ”‘ Byt ut mot ditt Supabase-projekts vÃ¤rden
    const SUPABASE_URL = "https://DIN-PROJEKT-URL.supabase.co";
    const SUPABASE_KEY = "DIN-ANON-KEY";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const itemList = document.getElementById("itemList");
    const itemInput = document.getElementById("itemInput");
    const errorBox = document.getElementById("errorBox");
    const loading = document.getElementById("loading");

    function showError(msg) {
      errorBox.textContent = msg;
      setTimeout(() => { errorBox.textContent = ""; }, 5000); // rensa efter 5 sek
    }

    function showLoading(show) {
      loading.style.display = show ? "block" : "none";
    }

    // HÃ¤mta lista
    async function loadItems() {
      try {
        showLoading(true);
        const { data, error } = await supabase.from("items").select("*").order("id");
        if (error) throw error;
        renderItems(data);
      } catch (err) {
        console.error("Fel vid fetch:", err);
        showError("Kunde inte ladda listan.");
      } finally {
        showLoading(false);
      }
    }

    // Rendera lista i DOM
    function renderItems(items) {
      itemList.innerHTML = "";
      items.forEach(item => {
        const li = document.createElement("li");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.onchange = () => toggleItem(item.id, !item.checked);

        li.appendChild(checkbox);
        li.appendChild(document.createTextNode(item.name));
        itemList.appendChild(li);
      });
    }

    // LÃ¤gg till vara
    async function addItem() {
      const name = itemInput.value.trim();
      if (!name) return;

      try {
        const { error } = await supabase.from("items").insert([{ name }]);
        if (error) throw error;
        itemInput.value = "";
      } catch (err) {
        console.error("Fel vid insert:", err);
        showError("Kunde inte lÃ¤gga till vara. Kontrollera anslutningen.");
      }
    }

    // Uppdatera avbockning
    async function toggleItem(id, checked) {
      try {
        const { error } = await supabase.from("items").update({ checked }).eq("id", id);
        if (error) throw error;
      } catch (err) {
        console.error("Fel vid update:", err);
        showError("Kunde inte uppdatera vara.");
      }
    }

    // Realtidsuppdatering
    supabase.channel("room1")
      .on("postgres_changes", { event: "*", schema: "public", table: "items" }, payload => {
        loadItems(); // laddar om listan nÃ¤r nÃ¥got Ã¤ndras
      })
      .subscribe();

    loadItems();
  </script>
</body>
</html>
