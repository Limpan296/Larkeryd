<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>InkÃ¶pslista</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    h1 { color: #2c3e50; }
    ul { list-style: none; padding: 0; }
    li { margin: 8px 0; }
    input[type="checkbox"] { margin-right: 8px; }
    #messageBox { margin: 10px 0; font-weight: bold; }
    .error { color: red; }
    .success { color: green; }
    #loading { color: #555; margin: 10px 0; font-style: italic; }
  </style>
</head>
<body>
  <h1>ðŸ›’ InkÃ¶pslista</h1>
  <div id="messageBox"></div>
  <div id="loading" style="display:none;">Laddar lista...</div>

  <input id="itemInput" placeholder="LÃ¤gg till vara..." />
  <button onclick="addItem()">âž• LÃ¤gg till</button>
  <ul id="itemList"></ul>

  <script type="module">
   
    import { createClient } from '@supabase/supabase-js'
    const supabaseUrl = 'https://wkdognpbmqrtuxbpsiie.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndrZG9nbnBibXFydHV4YnBzaWllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NTE2NDQsImV4cCI6MjA3NDEyNzY0NH0.l6F-mhXSkJxiQuQU8aAA3Iu0FXdaG5HgWxJQ3it7HUE'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const itemList = document.getElementById("itemList");
    const itemInput = document.getElementById("itemInput");
    const messageBox = document.getElementById("messageBox");
    const loading = document.getElementById("loading");

    function showMessage(msg, type = "success") {
      messageBox.textContent = msg;
      messageBox.className = type; // "success" eller "error"
      setTimeout(() => { messageBox.textContent = ""; }, 3000);
    }

    function showLoading(show) {
      loading.style.display = show ? "block" : "none";
    }

    // HÃ¤mta lista
    async function loadItems() {
      try {
        showLoading(true);
        const { data, error } = await supabase.from("items").select("*").order("id");
        if (error) throw error;
        renderItems(data);
      } catch (err) {
        console.error("Fel vid fetch:", err);
        showMessage("Kunde inte ladda listan.", "error");
      } finally {
        showLoading(false);
      }
    }

    // Rendera lista i DOM
    function renderItems(items) {
      itemList.innerHTML = "";
      items.forEach(item => {
        const li = document.createElement("li");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.onchange = () => toggleItem(item.id, !item.checked);

        li.appendChild(checkbox);
        li.appendChild(document.createTextNode(item.name));
        itemList.appendChild(li);
      });
    }

    // LÃ¤gg till vara
    async function addItem() {
      const name = itemInput.value.trim();
      if (!name) return;

      try {
        const { error } = await supabase.from("items").insert([{ name }]);
        if (error) throw error;
        itemInput.value = "";
        showMessage("âœ… Varor tillagd!");
      } catch (err) {
        console.error("Fel vid insert:", err);
        showMessage("Kunde inte lÃ¤gga till vara. Kontrollera anslutningen.", "error");
      }
    }

    // Uppdatera avbockning
    async function toggleItem(id, checked) {
      try {
        const { error } = await supabase.from("items").update({ checked }).eq("id", id);
        if (error) throw error;
      } catch (err) {
        console.error("Fel vid update:", err);
        showMessage("Kunde inte uppdatera vara.", "error");
      }
    }

    // Realtidsuppdatering
    supabase.channel("room1")
      .on("postgres_changes", { event: "*", schema: "public", table: "items" }, payload => {
        loadItems();
      })
      .subscribe();

    loadItems();
  </script>
</body>
</html>
